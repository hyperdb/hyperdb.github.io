---
import { getCollection, render } from "astro:content";
import Layout from "@/layouts/Layout.astro";

export async function getStaticPaths() {
    const posts = await getCollection("posts");
    return posts
        .filter((post) => post.data.status === "publish")
        .map((post) => ({
            params: { slug: post.data.slug },
        }));
}

const { slug } = Astro.params;

// slugからpostを取得
const posts = await getCollection("posts");
const post = posts.find((p) => p.data.slug === slug);

if (!post) {
    return Astro.redirect("/404");
}

const { Content } = await render(post);
---

<Layout>
    <article>
        <div class="post-header">
            <h1>{post.data.title}</h1>
            <div class="meta">
                <time datetime={post.data.created_at}>
                    {
                        new Date(post.data.created_at).toLocaleDateString(
                            "ja-JP",
                            {
                                year: "numeric",
                                month: "long",
                                day: "numeric",
                            }
                        )
                    }
                </time>
                {
                    post.data.category && (
                        <span class="category">{post.data.category}</span>
                    )
                }
                {
                    post.data.tags && post.data.tags.length > 0 && (
                        <div class="tags">
                            {post.data.tags.map((tag) => (
                                <span class="tag">{tag}</span>
                            ))}
                        </div>
                    )
                }
            </div>
        </div>
        <div class="page-content">
            <Content />
        </div>
        <div class="post-footer">
            <a href="/posts">投稿一覧に戻る</a>
        </div>
    </article>
</Layout>

<style lang="scss">
    article {
        max-width: 900px;
        margin: 0 auto;
    }
</style>
